@page
@model EnableAuthenticatorModel
@{
    ViewData["Title"] = "Configure authenticator app";
    ViewData["ActivePage"] = ManageNavPages.TwoFactorAuthentication;
}

@section PageSubtitle {
        Set up an authenticator app to generate verification codes for sign-in.
}

<div class="mt-2">
    <div class="card shadow-sm">
        <div class="card-body">
            <h5 class="card-title mb-2">Step 1: Install an authenticator app</h5>
            <div class="text-body-secondary">
                Use an authenticator app such as Microsoft Authenticator or Google Authenticator.
            </div>

            <div class="mt-3">
                <div class="d-flex flex-wrap gap-2">
                    <a class="btn btn-outline-secondary"
                       href="https://go.microsoft.com/fwlink/?Linkid=825072"
                       target="_blank" rel="noopener noreferrer">
                        Microsoft Authenticator (Android)
                    </a>
                    <a class="btn btn-outline-secondary"
                       href="https://go.microsoft.com/fwlink/?Linkid=825073"
                       target="_blank" rel="noopener noreferrer">
                        Microsoft Authenticator (iOS)
                    </a>
                    <a class="btn btn-outline-secondary"
                       href="https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2&amp;hl=en"
                       target="_blank" rel="noopener noreferrer">
                        Google Authenticator (Android)
                    </a>
                    <a class="btn btn-outline-secondary"
                       href="https://itunes.apple.com/us/app/google-authenticator/id388497605?mt=8"
                       target="_blank" rel="noopener noreferrer">
                        Google Authenticator (iOS)
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="card shadow-sm mt-3">
        <div class="card-body">
            <h5 class="card-title mb-2">Step 2: Add your account</h5>
            <div class="text-body-secondary mb-3">
                Scan the QR code below, or enter the key manually. Spaces and casing do not matter.
            </div>

            <div class="row g-3">
                <div class="col-12 col-lg-6">
                    <div class="border rounded p-3 bg-body">
                        <div class="fw-semibold mb-2">QR code</div>

                        @* The default Identity UI script will render into this div *@
                        <div id="qrCode" class="d-flex align-items-center justify-content-center"></div>

                        @* Used by the QR rendering script *@
                        <div id="qrCodeData" data-url="@Model.AuthenticatorUri"></div>

                        <div class="form-text mt-2">
                            If the QR code is not visible, ensure scripts are enabled.
                        </div>
                    </div>
                </div>

                <div class="col-12 col-lg-6">
                    <div class="border rounded p-3 bg-body">
                        <div class="fw-semibold mb-2">Manual key</div>

                        <div class="mb-2">
                            <kbd class="user-select-all">@Model.SharedKey</kbd>
                        </div>

                        <div class="form-text">
                            Enter this key into your authenticator app if you cannot scan the QR code.
                        </div>

                        <div class="alert alert-info mt-3 mb-0" role="alert">
                            Learn how to <a href="https://go.microsoft.com/fwlink/?Linkid=852423" target="_blank" rel="noopener noreferrer">enable QR code generation</a>.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <form id="send-code" method="post" class="card shadow-sm mt-3">
        @Html.AntiForgeryToken()

        <div class="card-body">
            <h5 class="card-title mb-2">Step 3: Verify setup</h5>
            <div class="text-body-secondary mb-3">
                Enter the 6-digit code generated by your authenticator app to complete setup.
            </div>

            <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>

            <div class="row g-3">
                <div class="col-12">
                    <div class="form-floating">
                        <input asp-for="Input.Code"
                               class="form-control"
                               autocomplete="off"
                               inputmode="numeric"
                               placeholder="123456" />
                        <label asp-for="Input.Code">Verification code</label>
                    </div>
                    <span asp-validation-for="Input.Code" class="text-danger"></span>
                </div>

                <div class="col-12">
                    <hr class="my-2" />
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary">
                            Verify
                        </button>

                        <a asp-page="./TwoFactorAuthentication" class="btn btn-outline-secondary">
                            Back
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}